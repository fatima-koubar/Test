import { ApplePayLiveAdapter } from './apple-pay-live-adapter';

describe('ApplePayLiveAdapter', () => {
  let service: ApplePayLiveAdapter;
  let mockApplePaySession: typeof window.ApplePaySession;

  beforeEach(() => {
    service = new ApplePayLiveAdapter();

    mockApplePaySession = {
      canMakePayments: jasmine.createSpy('canMakePayments').and.returnValue(true),
      completePayment: jasmine.createSpy('completePayment'),
      begin: jasmine.createSpy('begin'),
      abort: jasmine.createSpy('abort'),

      onvalidatemerchant: jasmine.createSpy('onvalidatemerchant') as any,
      completeMerchantValidation: jasmine.createSpy('completeMerchantValidation'),
      onpaymentauthorized: jasmine.createSpy('onpaymentauthorized') as any,
      applePayCapabilities: jasmine.createSpy('applePayCapabilities'),
      oncancel: jasmine.createSpy('oncancel'),

      STATUS_SUCCESS: 1,
      STATUS_FAILURE: 2,
    } as unknown as typeof window.ApplePaySession;
  });

  it('should set the Apple Pay session', () => {
    service.setSession(mockApplePaySession);

    expect((service as any).session).toBe(mockApplePaySession);
  });

  it('should call begin() when starting a transaction', () => {
    service.setSession(mockApplePaySession);

    service.startTransaction();

    expect(mockApplePaySession.begin).toHaveBeenCalled();
  });
});
