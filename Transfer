
genere un unit test pour ce code angular avec jasmine

const MOBILE_DIALOG_CLASS = 'ei_dialog';
const DESKTOP_DIALOG_CLASS = 'full-screen-dialog';
const MOBILE_BREAKPOINT = '(max-width: 600px)';

export class ApplePaySandboxAdapter extends ApplePayAdapterService {
  private readonly _dialog = inject(MatDialog);
  private readonly _applePayService = inject(ApplePayService);
  private readonly _breakpointObserver = inject(BreakpointObserver);

  setSession(): void {
    return;
  }

  async startTransaction(): Promise<void> {
    const isMobile = this._breakpointObserver.isMatched(MOBILE_BREAKPOINT);
    const dialogRef = this._dialog.open<ApplePayTestCardsComponent, unknown, TestCard | undefined>(
      ApplePayTestCardsComponent,
      {
        panelClass: isMobile ? [MOBILE_DIALOG_CLASS, DESKTOP_DIALOG_CLASS] : MOBILE_DIALOG_CLASS,
      },
    );

    const testCard = await firstValueFrom(dialogRef.afterClosed());
    if (!testCard) {
      throw new Error('ApplePaySandboxSDKAdapter | startTransaction | Carte de test inexistante.');
    }
    this._applePayService.putToken(this.buildApplePayToken(testCard));
  }

  private buildApplePayToken(testCard: TestCard): string {
    const tokenPayload = {
      account_number: testCard.account_number,
      expiration_date: TestCardsService.getTwoYearsFromNowFormattedDate(),
      cvx: '666',
      holder_name: 'John Doe',
      scheme: testCard.scheme,
    };

    return btoa(JSON.stringify(tokenPayload));
  }
}
