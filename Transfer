
genere un unit test pour ce code angular avec jasmine

@Injectable({
  providedIn: 'root',
})
export class ApplePayTestCardsService {
  readonly sortedTestCards: WritableSignal<TestCard[]> = signal<Array<TestCard>>([]);
  readonly testCardsByScheme: WritableSignal<Partial<Record<SchemeType, Array<TestCard>>>> = signal<
    Partial<Record<SchemeType, Array<TestCard>>>
  >({});
  readonly arrayPaiementOptions: WritableSignal<ArrayOption[]> = signal<ArrayOption[]>([]);

  private readonly _translateService = inject(TranslateService);
  private readonly _applePayFlowService = inject(ApplePayFlowService);

  getSortedCards(): TestCard[] {
    return this.sortedTestCards();
  }

  setSortedCards(): void {
    this.sortedTestCards.set(
      [...this._applePayFlowService.testCards()].sort((a, b) => a.scheme.localeCompare(b.scheme)),
    );
  }

  setTestCardsByScheme(): void {
    this.testCardsByScheme.set(
      this.sortedTestCards().reduce(
        (acc: Partial<Record<SchemeType, Array<TestCard>>>, testCard) =>
          Object.assign(acc, {
            [testCard.scheme]: (acc[testCard.scheme] ?? []).concat(testCard),
          }),
        {},
      ),
    );
  }

  getArrayPaiementOptions(): ArrayOption[] {
    return this.arrayPaiementOptions();
  }

  setArrayPaiementOptions(): void {
    let index = 0;
    this.arrayPaiementOptions.set(
      Object.entries(this.testCardsByScheme()).map<ArrayOption>((entry) => ({
        optionGroupName: entry[0],
        options: entry[1].reduce((options: Array<Option>, testCard) => {
          const scenarioStatusLabel = this.getScenarioStatusLabel(testCard);
          const threeDSLabel = this.getThreeDSLabel(testCard);
          if (!testCard.authentication_scenario) {
            options.push(
              new Option(`sc-${index}`, `${testCard.scheme} - ${scenarioStatusLabel}`, ''),
            );
            return options;
          }

          options.push(
            new Option(
              `sc-${index}`,
              `${testCard.scheme} - ${scenarioStatusLabel} - ${threeDSLabel}`,
              '',
            ),
          );
          index++;
          return options;
        }, []),
      })),
    );
  }

  private getScenarioStatusLabel(testCard: TestCard): string {
    return testCard.authorization_scenario === AuthorizationScenario.ACCEPTED
      ? this._translateService.instant('PAYMENT_MEANS.CARD.TEST_CARD.PAYMENT_STATUS.ACCEPTED')
      : this._translateService.instant('PAYMENT_MEANS.CARD.TEST_CARD.PAYMENT_STATUS.REFUSED');
  }

  private getThreeDSLabel(testCard: TestCard): string {
    return testCard.authentication_scenario &&
      testCard.authentication_scenario.result === AuthenticationResult.NOT_ENROLLED
      ? this._translateService.instant('PAYMENT_MEANS.CARD.TEST_CARD.3DS_STATUS.NOT_SUPPORTED')
      : this._translateService.instant('PAYMENT_MEANS.CARD.TEST_CARD.3DS_STATUS.SUPPORTED');
  }
}

