describe('ApplePayAdapterService', () => {
  let service: ApplePayAdapterService;
  let ressourceLoaderSpy: jasmine.SpyObj<RessourceLoaderService>;
  let mockApplePaySession: typeof window.ApplePaySession;

  beforeEach(() => {
    ressourceLoaderSpy = jasmine.createSpyObj('RessourceLoaderService', [
      'loadScript',
      'getLoadedResource',
    ]);

    mockApplePaySession = {
      canMakePayments: jasmine.createSpy('canMakePayments').and.returnValue(true),
      applePayCapabilities: jasmine.createSpy('applePayCapabilities'),
    } as unknown as typeof window.ApplePaySession;

    TestBed.configureTestingModule({
      providers: [
        ApplePayAdapterService,
        { provide: RessourceLoaderService, useValue: ressourceLoaderSpy },
      ],
    });

    service = TestBed.inject(ApplePayAdapterService);
  });

  describe('canApplePayPayment', () => {
    it('should return true when script is loaded and Apple Pay is available', () => {
      ressourceLoaderSpy.getLoadedResource.and.returnValue({
        promise: Promise.resolve(),
        element: {} as HTMLScriptElement,
      });

      expect(service.canApplePayPayment()).toBeTrue();
    });
  });
});


file ts

canApplePayPayment(): boolean {
    return (
      Boolean(this._ressourceLoader.getLoadedResource(this.APPLE_PAY_SDK_URL)) &&
      window.ApplePaySession.canMakePayments()
    );
  }

applePaySession type 
 ApplePaySession: {
      canMakePayments(): boolean;
      completePayment(status: number): void;
      begin(): void;
      abort(): void;

      onvalidatemerchant: (event: ApplePayValidateMerchantEvent) => void;
      completeMerchantValidation(merchantSession: MerchantSession | undefined): void;
      onpaymentauthorized: (event: ApplePayPaymentAuthorizationEvent) => void;
      applePayCapabilities(merchantIdentifier: string): Promise<PaymentCredentialStatusResponse>;
      oncancel: () => void;

      STATUS_SUCCESS: number;
      STATUS_FAILURE: number;
    };
